<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <title>Title</title>
</head>
<body>

</body>
</html>
<!--watch-->
<script>
class Watcher {
	constructor (vm, expOrFn, cb) {
		this.vm = vm
      this.getter = parsePath(expOrFn)
      this.cb = cb
      this.value = this.get()
   }
   get () {
		console.log('getter')
		window.target = this
      let value = this.getter.call(this.vm, this.vm)
      window.target = undefined
      return value
   }
   update () {
	   console.log('update')
		const oldVal = this.value
      this.value = this.get()
      this.cb.call(this.vm, this.value, oldVal)
   }
}
const bailRE = /[^\w.$]/
function parsePath(path) {
   if (bailRE.test(path)) {
   	return
   }
   const segments = path.split('.')
   return function (obj) {
	   console.log('getter2')
      for (let i = 0; i < segments.length; i++) {
      	if (!obj) return
         obj = obj[segments[i]]
      }
      return obj
   }
}
let vm = {
	a: 1,
   b: {
		c: 2
   },
   c () {

   }
}
vm.$watcher = new Watcher(vm,  'b.c', function (newVal, oldVal) {
   console.log('watch')
   console.log('newVal:' + newVal)
   console.log('oldVal:' + oldVal)
})
vm.b.c = 3
console.log(Object.getOwnPropertyDescriptor(vm, 'c'))
</script>
